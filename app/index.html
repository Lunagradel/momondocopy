<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>FlightSearch</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans:300" rel="stylesheet">
    <script src="https://use.fontawesome.com/bce7f6c050.js"></script>
    <script src="../node_modules/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../node_modules/sweetalert/dist/sweetalert.css">
  </head>
  <body>
    <div id="search-bar">
      <div class="login">
        <button class='btnLogout regular-button'>Logout</button>
        <button data-canvas="login" class="btnLogin regular-button">Login</button>
        <button data-canvas="register" class="btnRegister regular-button">Register</button>
        <button data-canvas="account" class='btnUser regular-button'>Account</button>
      </div>
      <form class="" action="index.html" method="post">
        <div class="">
          <span class="date-span">
            <input class="from" type="text" name="from" placeholder="From" maxlength="3">
            <i class="fa fa-arrows-h" aria-hidden="true"></i>
            <input class="to" type="text" name="to" placeholder="To">
          </span>
          <span class="bound-date">
            <i class="fa fa-calendar" aria-hidden="true"></i>
            <input placeholder="Inbound" class="from-date" type="text" name="fromDate" onfocus="(this.type='date')" onblur="(this.type='text')">
          </span>
          <span class="bound-date">
            <i class="fa fa-calendar" aria-hidden="true"></i>
            <input placeholder="Outbound" class="to-date" type="text" name="toDate" onfocus="(this.type='date')" onblur="(this.type='text')">
          </span>
          <span class="number-return">
            <i class="fa fa-users" aria-hidden="true"></i>
            <input type="number" class="passengers" name="passengers" value="1">
            <select class="return" name="returnOneway">
              <option value="return">Return</option>
              <option value="oneway">One way</option>
            </select>
          </span>
          <button class="regular-button" type="button" name="submit" id="goSearch"><i class="fa fa-paper-plane fa-2x" aria-hidden="true"></i></button>
        </div>

      </form>
    </div>
    <div class="content">
      <!-- REGISTER IN  -->
      <section id="register" class="canvas">
        <div class="card box-overlay">
          <h3>REGISTER</h3>
            <form class="register" action="index.html" method="post">
              First name:</br>
              <input type="text" name="firstName" value="" placeholder="John">
              Last Name:</br>
              <input type="text" name="lastName" value="" placeholder="Doe">
              Email:</br>
              <input type="email" name="mail" value="" placeholder="example@example.com">
              Password:</br>
              <input type="password" name="Password" value="">
              Birthdate:</br>
              <input type="date" name="Bday" value="">
              <div class="gender">
                <input type="radio" class="genderInput" name="gender" value="male" checked> Male
                <input type="radio" class="genderInput" name="gender" value="female"> Female
              </div>
              Passport Number:</br>
              <input type="number" name="Passport" value="" placeholder="">
              Phone Number: </br>
              <input type="tel" name="Phone" value="" placeholder="Phone Nr">
              Company Name: </br>
              <input type="text" name="Company" value="" placeholder="Company Name">
              <div id="creditCard">
                <h3>Payment</h3>
                Credit Card Number:
                <input type="number" name="cardNr" value=""></br>
                Expiration Year:
                <input type="number" name="exYear" value=""></br>
                Expiration Month:
                <input type="number" name="exMnth" value=""></br>
                Cardholder Name:
                <input type="text" name="cardHolder" value="" placeholder="John Doe"></br>
              </div>
              <div type="button" id="submit" class="overlaybtn regular-button" name="submit">Register</div>
            </form>
        </div>
      </section>
      <!-- REGISTER OUT -->
      <!-- LOGIN IN -->
    <section id="LoginContainer" class="canvas">
        <div class="card box-overlay">
          <h3>LOGIN</h3>
          <form class="login">
            <span>
              <input type="email" name="loginMail" value="" placeholder="Email">
              <input type="Password" name="loginPass" value="" placeholder="Password">
            </span>
            <div type="button" id="login" class="overlaybtn regular-button" value="login" name="button">login</div>
          </form>
        </div>
      </section>
      <!-- LOGIN OUT -->
      <!-- ACCOUNT IN -->
      <section id="accountContainer" class="canvas">
        <div class="card box-overlay">
        </div>
      </section class="canvas">
      <!-- ACCOUNT OUT -->
      <div class="previousFlights">
        <div class="prevFlight card" data-flight-destination="xx">
          <div class="destinations">
            <span class="prev-from">AMS</span><i class="fa fa-long-arrow-right" aria-hidden="true"></i><span class="prev-to">CPH</span>
          </div>
          <div class="previous-search">
            <input class="new-from-date" type="date">
            <input class="new-to-date" type="date">
            <button class="regular-button prev-search" type="button" name="submit">Search</button>
          </div>
        </div>
        <div class="prevFlight card" data-flight-destination="xx">
          <div class="destinations">BRN<i class="fa fa-long-arrow-right" aria-hidden="true"></i>LND</div>
          <div class="previous-search">
            <input type="date">
            <input type="date">
            <button class="regular-button" type="button" name="submit">Search</button>
          </div>
        </div>
      </div>
      	<div class="search-result hidden">
      		<div class="results">
      			<div class="filters">
      				<div class="filter card" id="quick"><p>Quickest</p></div>
      				<div class="filter" id="cheap"><p>Cheapest</p></div>
      				<div class="filter card" id="best"><p>Best</p></div>
      			</div>
            <div class="search-card card">
              <div class="result-box">
        				<div class="flight-info">
        					<div class="info">
        						<p>11:45</p>
        						<p class="result-from">CPH</p>
                    <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
        						<p class="result-to">TLX</p>
        						<p>12:50</p>
        					</div>
        					<div class="info return-field">
        						<p>08:00</p>
        						<p class="result-to">TXL</p>
                    <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
        						<p class="result-from">CPH</p>
        						<p>09:05</p>
        					</div>
        				</div>

        				<div class="price-box">
        					<p>40 EUR</p>
        					<button class="regular-button">BOOK NOW</button>
        				</div>
        			</div>
        			<div class="further-info-button">
        						<p>Further travel suggestions</p>
        					</div>
        			<div class="further-info-box">
        				<div class="options">
        					<p>Public transport</p>
        					<div class="transport-info">
        						<p>TXL</p>
        						<div></div>
        						<p>your adress..</p>
        					</div>
        				</div>
        				<div class="options">
        					<p>Taxi</p>
        					<p>Approximately 20 min by taxi</p>
        				</div>
        			</div>
            </div>
      	</div>
    </div>
    <script>

      $(document).ready(function(){
        var lastSearch = JSON.parse(localStorage.lastSearch);
        $(".prev-from").empty();
        $(".prev-from").append(lastSearch.from);

        $(".prev-to").empty();
        $(".prev-to").append(lastSearch.to);
      });

      $(document).on('click', 'input[type="checkbox"]', function() {
        $('input[type="checkbox"]').not(this).prop('checked', false);

        var checkboxId = $(this).attr("id");

        if (checkboxId == "one"){
          choice = {"further":"public"};
          localeFurther = JSON.stringify(choice);
          localStorage.furtherTravel = localeFurther;
        }

        if (checkboxId == "two"){
          choice = {"further":"taxi"};
          localeFurther = JSON.stringify(choice);
          localStorage.furtherTravel = localeFurther;
        }


      });

      $(".price-box > button").click(function(event) {
        event.preventDefault();
        window.location.href = 'book.html';
      });

      var bSearched = false;

      $(".prev-search").click(function(){
        $(".return-field").show();
        var prevFromVal = $(".prev-from").text();
        var prevToVal = $(".prev-to").text();
        var newFromDate = $(".new-from-date").val()
        var newToDate = $(".new-to-date").val()
        console.log(newFromDate);

        if (newFromDate != "" && newToDate != ""){
          $(".search-result").removeClass("hidden");
          $(".previousFlights").addClass("hidden");

          $(".result-from").empty();
          $(".result-from").append(prevFromVal);

          $(".result-to").empty();
          $(".result-to").append(prevToVal);

          updateSearch = JSON.parse(localStorage.lastSearch);
          updateSearch.fromDate = newFromDate;
          updateSearch.toDate = newToDate;
          newSearch = JSON.stringify(updateSearch)
          localStorage.lastSearch = newSearch;

          if (updateSearch.returnValue == "oneway"){
            $(".return-field").hide();
          }
        }

        if (prevToVal == "ALEXANDERPLATZ 22") {
            var infoToAppend = '<div class="options">\
              <p class="option-header">Public transport</p>\
              <div class="transport-info">\
                <input type="checkbox" id="one">\
                <p>TXL</p>\
                <i class="fa fa-long-arrow-right" aria-hidden="true"></i>\
                <p>Alexanderplatz 22</p>\
              </div>\
            </div>\
            <div class="options">\
              <p class="option-header">Taxi</p>\
              <div><input type="checkbox" id="two"><p>Approximately 20 min by taxi</p></div>\
            </div>'

            $(".further-info-box").empty();
            $(".further-info-box").append(infoToAppend);
            $(".result-to").empty();
            $(".result-to").append("TLX");
        } else {
            $(".further-info-box").empty();
            $(".further-info-box").append('<p class="need-adress">Search for an adress to see more information</p>');
        }

      });

      $("#goSearch").click(function (event) {
        event.preventDefault();

        $(".return-field").show();


        var from = $(".from").val().toUpperCase();
        var to = $(".to").val().toUpperCase();
        var fromDate = $(".from-date").val();
        var toDate = $(".to-date").val();
        var passengers = $(".passengers").val();
        var returnValue = $(".return").val();

        if (from != "" && to != "" && toDate != "" && fromDate != ""){
          $(".search-result").removeClass("hidden");
          $(".previousFlights").addClass("hidden");

          $(".result-from").empty();
          $(".result-from").append(from);

          $(".result-to").empty();
          $(".result-to").append(to);

          if (returnValue == "oneway"){
            $(".return-field").hide();
          }

          if (to == "ALEXANDERPLATZ 22") {
              var infoToAppend = '<div class="options">\
                <p class="option-header">Public transport</p>\
                <div class="transport-info">\
                  <input type="checkbox">\
                  <p>TXL</p>\
                  <i class="fa fa-long-arrow-right" aria-hidden="true"></i>\
                  <p>Alexanderplatz 22</p>\
                </div>\
              </div>\
              <div class="options">\
                <p class="option-header">Taxi</p>\
                <div><input type="checkbox"><p>Approximately 20 min by taxi</p></div>\
              </div>'

              $(".further-info-box").empty();
              $(".further-info-box").append(infoToAppend);
              $(".result-to").empty();
              $(".result-to").append("TLX");
          } else {
              $(".further-info-box").empty();
              $(".further-info-box").append('<p class="need-adress">Search for an adress to see more information</p>');
          }

          localStorage.removeItem(lastSearch);

          var lastSearch = {"from":from, "to":to, "fromDate":fromDate, "toDate":toDate, "passengers":passengers, "returnValue":returnValue };
          console.log(lastSearch);
          localSearch = JSON.stringify(lastSearch);
          localStorage.lastSearch = localSearch;
        }
    });
    </script>

    <script src="js/pop-in-box.js" charset="utf-8"></script>
    <script src="js/userFunc.js" charset="utf-8"></script>
  </body>
</html>
